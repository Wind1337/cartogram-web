<!DOCTYPE html>
<html lang="en">

<head>
  <script src="{{ url_for('static', filename='tracking.js') }}"></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description"
    content="Free Cartogram Generator - Make cartograms for different countries using your own data!" />
  <meta name="author" content="Michael T. Gastner" />
  <meta property="og:title" content="Creating Cartograms Online" />
  <meta property="og:description"
    content="Free Cartogram Generator - Make cartograms for different countries using your own data!" />
  <meta property="og:site_name" content="go-cart.io" />
  <meta name="twitter:title" content="Creating Cartograms Online" />
  <meta name="twitter:description"
    content="Free Cartogram Generator - Make cartograms for different countries using your own data!" />
  <meta name="twitter:image" content="{{ url_for('static', filename='img/favicon.png') }}" />
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon.png') }}" />

  <title>Creating Cartograms Online</title>

  <!-- Bootstrap core CSS -->
  <!--<link href="{{ url_for('static', filename='bootstrap.min.css') }}" rel="stylesheet">-->

  <!-- Custom styles for this template -->
  <link href="https://fonts.googleapis.com/css?family=Comfortaa&display=swap" rel="stylesheet" />
  <link href="{{ url_for('static', filename='bootstrap.min.theme.css') }}" rel="stylesheet" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css"
    integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous" />
  <base target="_parent" />
  <style>
    footer p {
      font-size: small;
    }
  </style>
</head>

<body>
  <div class="container-fluid">
    <a class="navbar-brand" href="/">
      <img src="{{ url_for('static', filename='img/gocart_final.svg') }}" width="150" alt="go-cart.io logo"
        style="margin-left: 0px" />
    </a>
  </div>
  <div class="container-fluid mt-3">
    {% include 'cartogramui.html' %}
  </div>

  <div class="container-fluid">
    <footer class="text-secondary">
      <p>
        This cartogram was produced using the
        <a href="https://go-cart.io">go-cart.io</a> website using the
        <a href="https://www.pnas.org/content/115/10/E2156">Fast Flow-based Algorithm</a>
        developed by Gastner, Seguy, and More in 2018.
      </p>
      <p>
        go-cart.io website &copy;
        <a href="http://michaelgastner.com">Michael T. Gastner</a>
      </p>
    </footer>
  </div>
  <!-- /container -->

  <!-- Bootstrap core JavaScript
    ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"
    integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n"
    crossorigin="anonymous"></script>
  <script>
    window.jQuery || document.write('<script src="jquery.min.js"><\/script>');
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"
    integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"
    crossorigin="anonymous"></script>
  <script src="{{ url_for('static', filename='bootstrap.min.js') }}"></script>
  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <script src="{{ url_for('static', filename='ie10-viewport-bug-workaround.js') }}"></script>
  <script src="{{ asset.url_for('cartogram.js') }}?v={{cartogram_version}}"></script>

  {% if map_name is defined %}
  <script>
    window.onload = function () {
      window.cartogram = new Cartogram(
        "{{cartogram_url}}",
        "{{cartogramui_url}}",
        "{{cartogram_data_dir}}",
        "{{url_for('gridedit')}}",
        "{{getprogress_url}}",
        "{{cartogram_version}}",
        0.9
      );

      window.cartogram.switchMap("{{map_name}}", "", null, null, null, true);
    };
  </script>
  {% else %}
  <script>
    var cartogramui_data = {{ cartogramui_data| safe}};
    var cartogram_data = {{ cartogram_data| safe}};

    window.onload = function () {

      window.cartogram = new Cartogram("{{cartogram_url}}", "{{cartogramui_url}}", "{{cartogram_data_dir}}", "{{url_for('gridedit')}}", "{{getprogress_url}}", "{{cartogram_version}}", 0.9);

      /* We need to find out the map format. If the extrema is located in the bbox property, then we have
      GeoJSON. Otherwise, we have the old JSON format.
      */
      if (cartogram_data.hasOwnProperty("bbox")) {

        var extrema = {
          min_x: cartogram_data.bbox[0],
          min_y: cartogram_data.bbox[1],
          max_x: cartogram_data.bbox[2],
          max_y: cartogram_data.bbox[3]
        };

        // We check if the generated cartogram is a world map by detecting the extent key
        let world = false;
        if ("extent" in cartogram_data) {
          world = (cartogram_data.extent === 'world');
        }
        window.cartogram.switchMap("{{default_cartogram_handler}}", "", window.cartogram.newMapVersionData(cartogram_data.features, extrema, cartogramui_data.tooltip, null, null, 'GEOJSON', world), cartogramui_data.color_data);
      } else {
        window.cartogram.switchMap("{{default_cartogram_handler}}", "", window.cartogram.newMapVersionData(cartogram_data.features, cartogram_data.extrema, cartogramui_data.tooltip, null, null, 'GOCARTJSON'), cartogramui_data.color_data);
      }


    };
  </script>
  {% endif %}
</body>

</html>